{% extends "Base.html" %}

{# TODO: –ü–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ _self.genUrl(...) –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–∞–¥–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è #}
{% import _self as self %}

{% block title %}{{ projectName }}{% endblock %}

{% block head %}

    <link href="/css/index.css" rel="stylesheet">

{% endblock %}

{% block body %}

    <div class="searchField">
        <form action="/">
            <input type="search" placeholder="–í–≤–æ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏, –∞–≤—Ç–æ—Ä–∞, –∂–∞–Ω—Ä‚Ä¶" name="search_query"
                   class="searchField" value="{{ search_query }}">
            <button type="submit" class="searchField">üîç</button>
        </form>
    </div>

    <div class="content">
        {% if search_query is not null %}
            <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É ¬´{{ search_query }}¬ª</p>
        {% endif %}
        <table>
            <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ
                    <div class="panelSort">
                        {{ self.genSortUrl(_context, "sorting_books", "book_name_ascending", "‚ñ≤") }}
                        {{ self.genSortUrl(_context, "sorting_books", "book_name_descending", "‚ñº") }}
                    </div>
                </th>
                <th>–†–µ–π—Ç–∏–Ω–≥ –∫–Ω–∏–≥–∏
                    <div class="panelSort">
                        {{ self.genSortUrl(_context, "sorting_books", "book_rating_ascending", "‚ñ≤") }}
                        {{ self.genSortUrl(_context, "sorting_books", "book_rating_descending", "‚ñº") }}
                    </div>
                </th>
                <th>–ê–≤—Ç–æ—Ä
                    <div class="panelSort">
                        {{ self.genSortUrl(_context, "sorting_books", "author_name_ascending", "‚ñ≤") }}
                        {{ self.genSortUrl(_context, "sorting_books", "author_name_descending", "‚ñº") }}
                    </div>
                </th>
                <th>–†–µ–π—Ç–∏–Ω–≥ –∞–≤—Ç–æ—Ä–∞
                    <div class="panelSort">
                        {{ self.genSortUrl(_context, "sorting_books", "author_rating_ascending", "‚ñ≤") }}
                        {{ self.genSortUrl(_context, "sorting_books", "author_rating_descending", "‚ñº") }}
                    </div>
                </th>
                <th colspan="1">–ñ–∞–Ω—Ä
                    <div class="panelSort">
                        {{ self.genSortUrl(_context, "sorting_books", "genre_name_ascending", "‚ñ≤") }}
                        {{ self.genSortUrl(_context, "sorting_books", "genre_name_descending", "‚ñº") }}
                    </div>
                </th>
                <th>–û–ø–µ—Ä–∞—Ü–∏–∏</th>
            </tr>
            </thead>
            <tbody>
            {% for book in books %}
                <tr>
                    <td>{{ book.name }}</td>
                    <td>{{ self.printRating(book.rating) }}</td>
                    {% if authors[book.author_id] is not null %}
                        <td>{{ authors[book.author_id].name }}</td>
                        <td>{{ self.printRating(authors[book.author_id].rating) }}</td>
                    {% else %}
                        <td>–ê–Ω–æ–Ω–∏–º</td>
                        <td>{{ self.printRating(0) }}</td>
                    {% endif %}
                    {% if genres[book.genre_id] is not null %}
                        <td>{{ genres[book.genre_id].name }}</td>
                    {% else %}
                        <td>‚Äî</td>
                    {% endif %}
                    <td>
                        <a href="/book/edit/{{ book.id }}">üñâ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <a href="/book/delete/{{ book.id }}">‚ùå –£–¥–∞–ª–∏—Ç—å</a>
                    </td>
                </tr>
            {% endfor %}
            <tbody>
        </table>

        {% if (books)|length==0 %}
            {% if search_query is not null %}
                <p>–ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã‚Ä¶</p>
            {% else %}
                <p>–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ –ø—É—Å—Ç‚Ä¶</p>
            {% endif %}
        {% endif %}

        <p><a href="/book/add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É‚Ä¶</a></p>
    </div>

    <div class="content left">
        <h1>–ê–≤—Ç–æ—Ä—ã</h1>
        <table>
            <thead>
            <tr>
                <th>
                    –ò–º—è
                    <div class="panelSort">
                        {{ self.genSortUrl(_context, "sorting_authors", "author_name_ascending", "‚ñ≤") }}
                        {{ self.genSortUrl(_context, "sorting_authors", "author_name_descending", "‚ñº") }}
                    </div>
                </th>
                <th>
                    –†–µ–π—Ç–∏–Ω–≥
                    <div class="panelSort">
                        {{ self.genSortUrl(_context, "sorting_authors", "author_rating_ascending", "‚ñ≤") }}
                        {{ self.genSortUrl(_context, "sorting_authors", "author_rating_descending", "‚ñº") }}
                    </div>
                </th>
                <th>
                    –ö–æ–ª-–≤–æ –∫–Ω–∏–≥
                    <div class="panelSort">
                        {{ self.genSortUrl(_context, "sorting_authors", "author_number_books_ascending", "‚ñ≤") }}
                        {{ self.genSortUrl(_context, "sorting_authors", "author_number_books_descending", "‚ñº") }}
                    </div>
                </th>
                <th>–û–ø–µ—Ä–∞—Ü–∏–∏</th>
            </tr>
            </thead>
            <tbody>
            {% for author in authors %}
                <tr>
                    <td>{{ author.name }}</td>
                    <td>{{ self.printRating(author.rating) }}</td>
                    <td>{{ author.number_books }}</td>
                    <td>
                        <a href="/author/edit/{{ author.id }}">üñâ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <a href="/author/delete/{{ author.id }}">‚ùå –£–¥–∞–ª–∏—Ç—å</a>
                    </td>
                </tr>
            {% endfor %}
            <tbody>
        </table>

        {% if (authors)|length==0 %}
            {% if search_query is not null %}
                <p>–ê–≤—Ç–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã‚Ä¶</p>
            {% else %}
                <p>–°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤ –ø—É—Å—Ç‚Ä¶</p>
            {% endif %}
        {% endif %}

        <p><a href="/author/add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∞‚Ä¶</a></p>
    </div>

    <div class="content right">
        <h1>–ñ–∞–Ω—Ä—ã</h1>
        <table>
            <thead>
            <tr>
                <th>
                    –ò–º—è –∂–∞–Ω—Ä–∞
                    <div class="panelSort">
                        {{ self.genSortUrl(_context, "sorting_genres", "genre_name_ascending", "‚ñ≤") }}
                        {{ self.genSortUrl(_context, "sorting_genres", "genre_name_descending", "‚ñº") }}
                    </div>
                </th>
                <th>–û–ø–µ—Ä–∞—Ü–∏–∏</th>
            </tr>
            </thead>
            <tbody>
            {% for genre in genres %}
                <tr>
                    <td>{{ genre.name }}</td>
                    <td>
                        <a href="/genre/edit/{{ genre.id }}">üñâ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <a href="/genre/delete/{{ genre.id }}">‚ùå –£–¥–∞–ª–∏—Ç—å</a>
                    </td>
                </tr>
            {% endfor %}
            <tbody>
        </table>

        {% if (genres)|length==0 %}
            {% if search_query is not null %}
                <p>–ñ–∞–Ω—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã‚Ä¶</p>
            {% else %}
                <p>–°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ –ø—É—Å—Ç‚Ä¶</p>
            {% endif %}
        {% endif %}

        <p><a href="/genre/add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∂–∞–Ω—Ä‚Ä¶</a></p>
    </div>

{% endblock %}

{% macro genSortUrl(context, sort_name, sort_type, link_name) %}
    {% if context.sort_params[sort_name] != sort_type %}
        {% if context.search_query is not null %}
            <a href="/?search_query={{ context.search_query }}&{{ sort_name }}={{ sort_type }}">{{ link_name }}</a>
        {% else %}
            <a href="/?{{ sort_name }}={{ sort_type }}">{{ link_name }}</a>
        {% endif %}
    {% else %}
        {{ link_name }}
    {% endif %}
{% endmacro %}

{% macro printRating(rating) %}
    {% if rating >= 1 %}
        ‚òÖ {{ rating|number_format(1, ',', '') }}
    {% else %}
        ‚Äî
    {% endif %}
{% endmacro %}